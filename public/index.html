<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
    <meta name="googlebot" content="index, follow">
    <meta name="author" content="Alex Johnson">
    <meta name="keywords" content="IB CAS portfolio template, IB CAS activity tracker, Creativity Activity Service log, CAS reflections, CAS hours tracker, IB Diploma CAS requirements, CASfolio app">
    <meta name="theme-color" content="#1d4ed8">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <title>CASfolio | IB CAS Portfolio Builder & Activity Tracker</title>
    <meta name="description" content="Build your IB CAS portfolio fast: track Creativity, Activity & Service hours, organize reflections, and export coordinator-ready evidence for IB students.">
    <link rel="canonical" href="https://casfolio.vercel.app">
    <link rel="alternate" hreflang="en" href="https://casfolio.vercel.app">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml">
    <link rel="dns-prefetch" href="//fonts.googleapis.com">
    <link rel="dns-prefetch" href="//fonts.gstatic.com">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
    <link rel="preload" as="style" href="style.css">
    <link rel="preload" as="image" href="hero-default.svg" type="image/svg+xml">
    
    <!-- Open Graph tags -->
    <meta property="og:title" content="CASfolio | IB CAS Portfolio Builder & CAS Hours Tracker">
    <meta property="og:description" content="Build your IB CAS portfolio fast: track Creativity, Activity & Service hours, organize reflections, and export coordinator-ready evidence for IB students.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://casfolio.vercel.app">
    <meta property="og:site_name" content="CASfolio | IB CAS Portfolio Builder">
    <meta property="og:locale" content="en_US">
    <meta property="og:image" content="https://casfolio.vercel.app/hero-default.svg">
    <meta property="og:image:alt" content="CAS portfolio hero graphic">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="CASfolio | IB CAS Portfolio Builder & CAS Hours Tracker">
    <meta name="twitter:description" content="Build your IB CAS portfolio fast: track Creativity, Activity & Service hours, organize reflections, and export coordinator-ready evidence for IB students.">
    <meta name="twitter:image" content="https://casfolio.vercel.app/hero-default.svg">
    
    <!-- Font imports -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Styles -->
    <script>
        (function () {
            if (typeof window === 'undefined') {
                return;
            }

            const storageKey = 'casfolio_theme_preference';
            const root = document.documentElement;
            if (!root) {
                return;
            }

            const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            let stored = null;

            try {
                stored = localStorage.getItem(storageKey);
            } catch (error) {
                stored = null;
            }

            let setting = typeof stored === 'string' ? stored : 'system';
            if (setting !== 'light' && setting !== 'dark' && setting !== 'system') {
                setting = 'system';
            }

            const shouldUseDark = setting === 'dark' || (setting === 'system' && prefersDark);
            if (shouldUseDark) {
                root.classList.add('dark');
            } else {
                root.classList.remove('dark');
            }

            root.setAttribute('data-theme-setting', setting);
        })();
    </script>
    <link rel="stylesheet" href="style.css">
    <script type="application/ld+json">
        {
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "CASfolio | IB CAS Portfolio & Activity Tracker",
            "url": "https://casfolio.vercel.app",
            "inLanguage": "en",
            "description": "Build your IB CAS portfolio fast: track Creativity, Activity & Service hours, organize reflections, and export coordinator-ready evidence for IB students.",
            "publisher": {
                "@type": "Person",
                "name": "Alex Johnson"
            },
            "potentialAction": {
                "@type": "SearchAction",
                "target": "https://casfolio.vercel.app/?s={search_term_string}",
                "query-input": "required name=search_term_string"
            }
        }
    </script>
    <script>
        (function () {
            if (typeof window === 'undefined') {
                return;
            }

            if (!window.si) {
                window.si = function () {
                    (window.siq = window.siq || []).push(arguments);
                };
            }

            var scriptSrc = '/_vercel/speed-insights/script.js';
            if (document.head.querySelector('script[src*="' + scriptSrc + '"]')) {
                return;
            }

            var script = document.createElement('script');
            script.src = scriptSrc;
            script.defer = true;
            script.dataset.sdkn = '@vercel/speed-insights';
            script.dataset.sdkv = '1.2.0';
            var route = (window.location && window.location.pathname) || '/';
            script.dataset.route = route || '/';
            script.onerror = function () {
                console.log(
                    '[Vercel Speed Insights] Failed to load script from ' +
                        scriptSrc +
                        '. Please check if any content blockers are enabled and try again.'
                );
            };

            document.head.appendChild(script);
        })();
    </script>
</head>
<body>
    <!-- Navigation -->
    <nav class="nav">
        <div class="container" id="nav-container">
            <div class="nav-content">
                <div class="nav-brand" data-testid="link-home">
                    <div class="nav-logo">
                        <!-- Brand visual: uses image when provided, otherwise shows the icon -->
                        <img id="brand-image" alt="Brand logo" style="display:none;" />
                        <i id="brand-icon" class="fas fa-graduation-cap" aria-hidden="true"></i>
                    </div>
                    <h1>CASfolio</h1>
                </div>
                
                <div class="nav-right">
                    <!-- Desktop Navigation -->
                    <div class="nav-links">
                        <button onclick="scrollToSection('home')" data-testid="nav-home">Home</button>
                        <button onclick="scrollToSection('timeline')" data-testid="nav-timeline">Timeline</button>
                        <button onclick="scrollToSection('contact')" data-testid="nav-contact">Export</button>
                        <button onclick="openCustomizePanel()" aria-label="Customize" title="Customize" data-testid="nav-customize">Customize</button>
                    </div>

                <div class="nav-actions">
                    <div class="theme-switcher" data-theme-control>
                        <button class="btn btn-icon" type="button" aria-haspopup="true" aria-expanded="false" data-theme-trigger data-testid="button-theme-toggle">
                            <i class="fas fa-circle-half-stroke" data-theme-icon></i>
                            <span class="sr-only" data-theme-trigger-label>Theme</span>
                        </button>
                        <div class="theme-menu" role="menu" aria-label="Select theme">
                            <button type="button" class="theme-option" data-theme-option data-theme-value="light" role="menuitemradio" aria-checked="false">
                                <i class="fas fa-sun"></i>
                                <span>Light</span>
                            </button>
                            <button type="button" class="theme-option" data-theme-option data-theme-value="dark" role="menuitemradio" aria-checked="false">
                                <i class="fas fa-moon"></i>
                                <span>Dark</span>
                            </button>
                            <button type="button" class="theme-option" data-theme-option data-theme-value="system" role="menuitemradio" aria-checked="false">
                                <i class="fas fa-circle-half-stroke"></i>
                                <span>System</span>
                            </button>
                        </div>
                    </div>
                    <button id="casfolio-logout" class="btn btn-primary" type="button" hidden>
                        <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                        <span>Logout</span>
                    </button>
                </div>

                    <!-- Mobile Menu Button -->
                    <button class="mobile-menu-btn" onclick="toggleMobileMenu()" data-testid="button-mobile-menu">
                        <i class="fas fa-bars" id="mobile-menu-icon"></i>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation -->
            <div class="mobile-menu" id="mobile-menu" data-testid="mobile-menu">
                <button onclick="scrollToSection('home')" data-testid="nav-mobile-home">Home</button>
                <button onclick="scrollToSection('timeline')" data-testid="nav-mobile-timeline">Timeline</button>
                <button onclick="scrollToSection('contact')" data-testid="nav-mobile-contact">Export</button>
                <button onclick="openCustomizePanel()" data-testid="nav-mobile-customize">Customize</button>
                <div class="theme-switcher theme-switcher--mobile" data-theme-control>
                    <button class="btn btn-outline" type="button" aria-haspopup="true" aria-expanded="false" data-theme-trigger data-testid="button-theme-toggle-mobile">
                        <i class="fas fa-circle-half-stroke" data-theme-icon></i>
                        <span data-theme-trigger-label>Theme</span>
                    </button>
                    <div class="theme-menu" role="menu" aria-label="Select theme">
                        <button type="button" class="theme-option" data-theme-option data-theme-value="light" role="menuitemradio" aria-checked="false">
                            <i class="fas fa-sun"></i>
                            <span>Light</span>
                        </button>
                        <button type="button" class="theme-option" data-theme-option data-theme-value="dark" role="menuitemradio" aria-checked="false">
                            <i class="fas fa-moon"></i>
                            <span>Dark</span>
                        </button>
                        <button type="button" class="theme-option" data-theme-option data-theme-value="system" role="menuitemradio" aria-checked="false">
                            <i class="fas fa-circle-half-stroke"></i>
                            <span>System</span>
                        </button>
                    </div>
                </div>
                <a href="/login" class="btn btn-primary mobile-login" id="casfolio-mobile-login">
                    <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                    <span>Login</span>
                </a>
                <button id="casfolio-logout-mobile" class="btn btn-outline mobile-logout" type="button" hidden>
                    <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
                    <span>Logout</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section id="home" class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="hero-text">
                    <h1 id="hero-title" data-testid="text-hero-title" data-editable="true">CASfolio: IB CAS Portfolio & Activity Tracker</h1>
                    <p id="hero-subtitle" class="hero-subtitle" data-testid="text-hero-subtitle" data-editable="true">Complete toolkit for Creativity, Activity & Service documentation</p>
                    <p id="hero-description" class="hero-description" data-testid="text-hero-description" data-editable="true">
                        Document your IB CAS experiences, track Creativity, Activity & Service hours, capture reflections, and showcase evidence with customizable sections and analytics.
                    </p>
                    
                    <div class="hero-stats">
                        <div class="stat-card">
                            <div class="stat-number" data-testid="text-total-activities" id="total-activities">-</div>
                            <div class="stat-label">Activities</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" data-testid="text-total-hours" id="total-hours">+2</div>
                            <div class="stat-label">Hours</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-months" data-testid="text-duration">-</div>
                            <div class="stat-label">Months</div>
                        </div>
                    </div>
                    
                    <div class="hero-buttons">
                        <button class="btn btn-primary" onclick="scrollToSection('recent')" data-testid="button-view-journey">
                            <i class="fas fa-eye"></i>
                            View My Journey
                        </button>
                        <button class="btn btn-outline" onclick="handleDownload()" data-testid="button-download-portfolio">
                            <i class="fas fa-download"></i>
                            Download Portfolio
                        </button>
                    </div>
                </div>
                
                <div class="hero-image">
                    <div class="hero-dropzone" id="hero-image-dropzone" role="button" tabindex="0" aria-label="Upload hero image">
                        <input id="hero-image-input" type="file" accept="image/*" aria-label="Choose hero image">
                        <div class="hero-dropzone-content" id="hero-dropzone-content">
                            <i class="fas fa-cloud-upload-alt" aria-hidden="true"></i>
                            <p class="hero-dropzone-title">Drop an image or click to upload</p>
                            <p class="hero-dropzone-subtitle">PNG, JPG, GIF up to 5MB</p>
                        </div>
                        <img id="hero-profile-image"
                             alt="Student profile photo"
                             data-testid="img-student-profile"
                             hidden>
                    </div>
                    <div class="achievement-badge" id="hero-achievement-badge" hidden> <!-- This is hidden for generalization pourposes-->
                        <i class="fas fa-trophy"></i>
                        <span data-testid="text-achievement">CAS Coordinator's Award</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Activity Heatmap -->
    <section id="heatmap" class="activity-heatmap" role="region" aria-label="Activity Heatmap">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">Activity Heatmap</h2>
                <p data-testid="text-section-description">Visualise streaks and strand intensity with a GitHub-style contribution view.</p>
            </div>

            <div class="card heatmap-card">
                <div class="heatmap-toolbar">
                    <div class="heatmap-filter">
                        <label for="heatmap-range">Date range</label>
                        <select id="heatmap-range" class="select-control heatmap-range" data-testid="select-heatmap-range" disabled aria-disabled="true">
                            <option value="52w">Last 52 weeks</option>
                        </select>
                    </div>
                    <div class="heatmap-filter">
                        <span>Categories</span>
                        <div class="heatmap-category-toggle" id="heatmap-category-filters" role="group" aria-label="Filter heatmap by category">
                            <button type="button" class="heatmap-category-btn" data-heatmap-category="creativity">
                                <span class="legend-dot creativity" aria-hidden="true"></span>
                                <span>Creativity</span>
                            </button>
                            <button type="button" class="heatmap-category-btn" data-heatmap-category="activity">
                                <span class="legend-dot activity" aria-hidden="true"></span>
                                <span>Activity</span>
                            </button>
                            <button type="button" class="heatmap-category-btn" data-heatmap-category="service">
                                <span class="legend-dot service" aria-hidden="true"></span>
                                <span>Service</span>
                            </button>
                        </div>
                    </div>
                </div>

                <div class="heatmap-body">
                    <div id="activity-heatmap" class="calendar-heatmap" role="grid" aria-label="CAS activity heatmap"></div>
                    <div id="activity-heatmap-empty" class="empty-state" hidden>
                        <p data-testid="text-heatmap-empty">No CAS activity matches the selected filters yet.</p>
                    </div>
                    <div class="heatmap-legend" aria-hidden="true">
                        <span>Low (≤1 hr)</span>
                        <div class="heatmap-scale">
                            <span class="heatmap-cell level-1" title="1 hour or less"></span>
                            <span class="heatmap-cell level-2" title="More than 1 hour but less than 3 hours"></span>
                            <span class="heatmap-cell level-3" title="3 or more hours"></span>
                        </div>
                        <span>High (≥3 hrs)</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- CAS Overview -->
    <section id="overview" class="cas-overview" role="region" aria-label="CAS Overview">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">CAS Categories</h2>
                <p data-testid="text-section-description">Explore my journey through the three pillars of CAS, each contributing to personal growth and community impact.</p>
            </div>
            
            <div class="categories-grid" id="categories-grid">
                <!-- Categories will be populated by JavaScript -->
            </div>
        </div>
    </section>

    <!-- Recent Activities -->
    <section id="recent" class="recent-activities">
        <div class="container">
            <div class="section-header-with-button">
                <div>
                    <h2 data-testid="text-section-title">Recent Activities</h2>
                    <p data-testid="text-section-subtitle">Latest additions to my CAS portfolio</p>
                </div>
                <button class="btn btn-primary" onclick="openAddActivityDialog()" data-testid="button-add-activity">
                    <i class="fas fa-plus"></i>
                    Add Activity
                </button>
            </div>
            
            <div class="activities-grid" id="activities-grid">
                <!-- Activities will be populated by JavaScript -->
            </div>
            
            <div class="empty-state" id="activities-empty" style="display: none;">
                <p data-testid="text-no-activities">No activities have been added yet.</p>
                <button class="btn btn-primary" onclick="openAddActivityDialog()" data-testid="button-add-first-activity">
                    <i class="fas fa-plus"></i>
                    Add Your First Activity
                </button>
            </div>
        </div>
    </section>

    <!-- Timeline -->
    <section id="timeline" class="timeline-section">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">CAS Timeline</h2>
                <p data-testid="text-section-description">A chronological journey through my CAS activities, showing growth and development over time.</p>
            </div>
            
            <div class="timeline-container">
                <div class="timeline" id="timeline-list">
                    <!-- Timeline items will be populated by JavaScript -->
                </div>
                
                <div class="empty-state" id="timeline-empty" style="display: none;">
                    <p data-testid="text-no-timeline-activities">No activities to display in timeline yet.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Reflection Journal -->
    <section id="reflection" class="reflection-journal" role="region" aria-label="Reflection Journal">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">Reflection Journal</h2>
                <p data-testid="text-section-description">Personal insights and learnings from my CAS journey</p>
            </div>
            
            <!-- Add New Reflection -->
            <div class="card add-reflection-card">
                <div class="card-header">
                    <h3 data-testid="text-add-reflection-title">Add New Reflection</h3>
                    <button class="btn btn-primary" onclick="openAddReflectionDialog()" data-testid="button-add-reflection">
                        <i class="fas fa-plus"></i>
                        New Reflection
                    </button>
                </div>
                <p data-testid="text-add-reflection-description">Document your thoughts, insights, and learnings from your CAS activities.</p>
            </div>
        </div>
    </section>

    <!-- Progress Dashboard -->
    <section id="progress" class="progress-dashboard" role="region" aria-label="Progress Overview">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">Progress Overview</h2>
                <p data-testid="text-section-description">Track your CAS journey with detailed analytics and insights</p>
            </div>
            
            <div class="progress-grid">
                <!-- Hours Distribution -->
                <div class="progress-main">
                    <div class="card">
                        <h3 data-testid="text-hours-distribution-title">Hours Distribution</h3>
                        <div class="progress-categories" id="progress-categories">
                            <!-- Progress bars will be populated by JavaScript -->
                        </div>
                        
                        <div class="progress-summary">
                            <div class="summary-item">
                                <i class="fas fa-info-circle"></i>
                                <span data-testid="text-total-hours" id="progress-total-hours">Total: 120/150 hours</span>
                            </div>
                            <p class="progress-message" data-testid="text-progress-message" id="progress-message">
                                30 hours remaining to reach minimum requirement
                            </p>
                        </div>

                        <div class="experience-metrics">
                            <div class="metric-card">
                                <h4>Average Enjoyment</h4>
                                <div class="rating-display" id="average-rating-display" data-testid="text-average-rating">-</div>
                            </div>
                            <div class="metric-card">
                                <h4>Average Difficulty</h4>
                                <div class="metric-value" id="average-difficulty-display" data-testid="text-average-difficulty">-</div>
                            </div>
                        </div>

                        <div class="trend-card">
                            <h4>Difficulty Trend</h4>
                            <svg id="difficulty-trend-chart" class="trend-chart" viewBox="0 0 320 80" preserveAspectRatio="none"></svg>
                            <p class="trend-caption" data-testid="text-difficulty-trend-caption">Average difficulty over time</p>
                        </div>
                    </div>
                </div>
                
                <!-- Achievements & Quick Actions -->
                <div class="progress-sidebar">
                    <div class="card">
                        <h3 data-testid="text-achievements-title">Achievements</h3>
                        <div class="achievements-list" id="achievements-list">
                            <!-- Achievements will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 data-testid="text-quick-actions-title">Quick Actions</h3>
                        <div class="quick-actions">
                            <button class="btn btn-primary btn-full" onclick="openAddActivityDialog()" data-testid="button-add-activity-quick">
                                <i class="fas fa-plus"></i>
                                Add New Activity
                            </button>
                            <button class="btn btn-outline btn-full" data-testid="button-upload-photos">
                                <i class="fas fa-upload"></i>
                                Upload Photos
                            </button>
                            <button class="btn btn-outline btn-full" onclick="handleDownload()" data-testid="button-export-portfolio">
                                <i class="fas fa-download"></i>
                                Export Portfolio
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Activity Gallery -->
    <section id="gallery" class="activity-gallery">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">Activity Gallery</h2>
                <p data-testid="text-section-description">Visual documentation of my CAS experiences</p>
            </div>
            
            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <div class="filter-container">
                    <button class="filter-btn active" onclick="filterGallery('all')" data-testid="filter-all">All</button>
                    <button class="filter-btn" onclick="filterGallery('creativity')" data-testid="filter-creativity">Creativity</button>
                    <button class="filter-btn" onclick="filterGallery('activity')" data-testid="filter-activity">Activity</button>
                    <button class="filter-btn" onclick="filterGallery('service')" data-testid="filter-service">Service</button>
                </div>
            </div>
            
            <!-- Gallery Grid -->
            <div class="gallery-grid" id="gallery-grid">
                <!-- Gallery items will be populated by JavaScript -->
            </div>
            
            <div class="empty-state" id="gallery-empty" style="display: none;">
                <p data-testid="text-no-gallery-items">No activities found for the selected filter.</p>
            </div>
            
            <div class="gallery-footer">
                <button class="btn btn-primary" data-testid="button-view-all-photos">View All Photos</button>
            </div>
        </div>
    </section>

    <!-- Contact Section -->
    <section id="contact" class="contact-section">
        <div class="container">
            <div class="section-header">
                <h2 data-testid="text-section-title">Portfolio Information</h2>
                <p data-testid="text-section-description">Contact details and portfolio verification</p>
            </div>
            
            <div class="contact-grid">
                <!-- Student Information -->
                <div class="card">
                    <h3 data-testid="text-student-info-title">Student Information</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-user"></i>
                            <div>
                                <p data-testid="text-student-name">Isabella van Dijk</p>
                                <span data-testid="text-student-role">IB Diploma Candidate</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-school"></i>
                            <div>
                                <p data-testid="text-student-school">Noordwijk International College</p>
                                <span data-testid="text-graduation-class">Class of 2025</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <p data-testid="text-student-email">isabella.vandijk@noordwijk-ic.nl</p>
                                <span>Student Email</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-calendar"></i>
                            <div>
                                <p data-testid="text-cas-period">CAS Period: Aug 2023 – May 2025</p>
                                <span data-testid="text-cas-summary">Coastal stewardship, creativity & wellbeing</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Supervisor Information -->
                <div class="card" id="coordinator-card">
                    <h3 data-testid="text-supervisor-info-title">CAS Coordinator</h3>
                    <div class="contact-info">
                        <div class="contact-item">
                            <i class="fas fa-user-check"></i>
                            <div>
                                <p data-testid="text-supervisor-name">Mr. Ruben Janssen</p>
                                <span data-testid="text-supervisor-role">CAS Coordinator</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <div>
                                <p data-testid="text-supervisor-email">r.janssen@noordwijk-ic.nl</p>
                                <span>Coordinator Email</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <div>
                                <p data-testid="text-supervisor-phone">+31 71 123 4567</p>
                                <span>Office Phone</span>
                            </div>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-check-circle"></i>
                            <div>
                                <p data-testid="text-portfolio-verified">Portfolio In Progress</p>
                                <span data-testid="text-last-review">Last reviewed: Oct 28, 2024</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="supervisor-comment">
                        <p data-testid="text-supervisor-comment">
                            "Isabella consistently leads service initiatives with empathy and organisation, inspiring peers across Noordwijk International College."
                        </p>
                        <p class="signature" data-testid="text-supervisor-signature">- Mr. Janssen, CAS Coordinator</p>
                    </div>
                </div>
            </div>
            
            <!-- Portfolio Export Options -->
            <div class="card export-card">
                <h3 data-testid="text-export-title">Portfolio Export</h3>
                <p data-testid="text-export-description">Download your complete CAS portfolio for submission or presentation.</p>
                <div class="export-buttons">
                    <button class="btn btn-primary" onclick="handleDownload()" data-testid="button-download-pdf">
                        <i class="fas fa-file-text"></i>
                        Download PDF
                    </button>
                    <button class="btn btn-outline" onclick="handleDownload()" data-testid="button-print-portfolio">
                        <i class="fas fa-print"></i>
                        Print Portfolio
                    </button>
                    <button class="btn btn-outline" onclick="handleShare()" data-testid="button-share-link">
                        <i class="fas fa-share"></i>
                        Share Link
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-brand">
                    <div class="footer-logo">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <span>IB Noordwijk CAS Portfolio</span>
                </div>
                <div class="footer-links">
                    <span>© 2025 IB Noordwijk Student Portfolio</span>
                    <a href="#">Privacy</a>
                    <a href="#">Help</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Dialogs -->
    <!-- Portfolio Information Onboarding -->
    <div class="modal" id="portfolio-onboarding-modal" aria-hidden="true">
        <div class="modal-content onboarding" role="dialog" aria-modal="true" aria-labelledby="portfolio-onboarding-title">
            <div class="modal-header">
                <h3 id="portfolio-onboarding-title" data-testid="text-onboarding-title">Portfolio Information Setup</h3>
                <button class="modal-close" type="button" id="portfolio-onboarding-close" aria-label="Close questionnaire">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="modal-description" data-testid="text-onboarding-description">
                Answer a few questions so your portfolio details stay accurate. You only have to do this once.
            </p>
            <form id="portfolio-onboarding-form" class="modal-form" novalidate>
                <fieldset class="form-section">
                    <legend>Student Details</legend>
                    <div class="form-group">
                        <label for="onboarding-student-name">Student Name</label>
                        <input id="onboarding-student-name" name="student_name" type="text" placeholder="Alex Johnson" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-student-role">Program Role or Title</label>
                        <input id="onboarding-student-role" name="student_role" type="text" placeholder="IB Diploma Candidate" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-student-school">School</label>
                        <input id="onboarding-student-school" name="student_school" type="text" placeholder="International School of Excellence" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="onboarding-graduation-year">Graduation Class</label>
                            <input id="onboarding-graduation-year" name="graduation_class" type="text" placeholder="Class of 2025" required>
                        </div>
                        <div class="form-group">
                            <label for="onboarding-student-email">Student Email</label>
                            <input id="onboarding-student-email" name="student_email" type="email" placeholder="alex.johnson@student.ise.edu" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="onboarding-cas-period">CAS Period</label>
                            <input id="onboarding-cas-period" name="cas_period" type="text" placeholder="Sep 2023 - May 2025" required>
                        </div>
                        <div class="form-group">
                            <label for="onboarding-cas-summary">Program Summary</label>
                            <input id="onboarding-cas-summary" name="cas_summary" type="text" placeholder="Two-year program" required>
                        </div>
                    </div>
                </fieldset>

                <fieldset class="form-section">
                    <legend>Portfolio Status</legend>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="onboarding-portfolio-status">Portfolio Status</label>
                            <select id="onboarding-portfolio-status" name="portfolio_status" class="onboarding-portfolio-status select-control select-control--status" required>
                                <option value="" selected>Select status...</option>
                                <option value="pending">Pending Review</option>
                                <option value="in-progress">In Progress</option>
                                <option value="verified">Portfolio Verified</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="onboarding-last-reviewed">Last Reviewed</label>
                            <input id="onboarding-last-reviewed" name="last_reviewed" type="date" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-coordinator-comment">Verification Notes</label>
                        <textarea id="onboarding-coordinator-comment" name="verification_notes" rows="3" placeholder="" aria-describedby="onboarding-coordinator-comment-helper"></textarea>
                        <p id="onboarding-coordinator-comment-helper" class="helper-text">Optional reflection, quote, or verification remark.</p>
                    </div>
                </fieldset>

                <fieldset class="form-section optional-section">
                    <legend>
                        <label class="optional-toggle">
                            <input id="onboarding-include-coordinator" name="include_coordinator" type="checkbox">
                            Include CAS Coordinator details
                        </label>
                    </legend>
                    <div id="onboarding-coordinator-fields" class="optional-fields" hidden>
                        <div class="form-group">
                            <label for="onboarding-coordinator-name">Coordinator Name</label>
                            <input id="onboarding-coordinator-name" name="coordinator_name" type="text" placeholder="Ms. Sarah Martinez">
                        </div>
                        <div class="form-group">
                            <label for="onboarding-coordinator-role">Coordinator Title</label>
                            <input id="onboarding-coordinator-role" name="coordinator_role" type="text" placeholder="CAS Coordinator">
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="onboarding-coordinator-email">Coordinator Email</label>
                                <input id="onboarding-coordinator-email" name="coordinator_email" type="email" placeholder="s.martinez@ise.edu">
                            </div>
                            <div class="form-group">
                                <label for="onboarding-coordinator-phone">Office Phone</label>
                                <input id="onboarding-coordinator-phone" name="coordinator_phone" type="tel" placeholder="+1 (555) 123-4567">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="onboarding-coordinator-signature">Signature Line</label>
                            <input id="onboarding-coordinator-signature" name="coordinator_signature" type="text" placeholder="- Ms. Martinez, CAS Coordinator">
                        </div>
                    </div>
                </fieldset>

                <div class="modal-actions">
                    <button type="button" class="btn btn-outline" id="portfolio-onboarding-save-later" data-testid="button-onboarding-save-later">
                        <i class="fas fa-save"></i>
                        Save for Later
                    </button>
                    <button type="submit" class="btn btn-primary" data-testid="button-onboarding-complete">
                        <i class="fas fa-check"></i>
                        Save & Complete
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Activity Dialog -->
    <div class="modal" id="add-activity-modal">
        <div class="modal-content" data-testid="dialog-add-activity">
            <div class="modal-header">
                <h3 data-testid="text-dialog-title">Add New Activity</h3>
                <button class="modal-close" onclick="closeAddActivityDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="modal-description" data-testid="text-dialog-description">
                Document a new CAS activity with details about your involvement and learning.
            </p>
            
            <form id="add-activity-form" class="modal-form">
                <div class="form-group">
                    <label>Activity Title</label>
                    <input type="text" name="title" placeholder="Enter activity title..." data-testid="input-activity-title" required>
                </div>
                
                <div class="form-group">
                    <label>Header Image (Optional)</label>
                    <div class="image-upload-options">
                        <p class="helper-text">Provide a publicly accessible image URL.</p>
                        <input type="url" name="imageUrl" id="image-url-input" placeholder="https://example.com/image.jpg" data-testid="input-image-url">
                        <button type="button" id="load-image-url" class="btn btn-outline" style="margin-top: 8px;">Load Image</button>
                        
                        <div id="image-preview" class="image-preview" style="display: none; margin-top: 15px; text-align: center;">
                            <img id="image-preview-img" src="" alt="Preview" style="max-width: 100%; max-height: 200px; border-radius: 4px; margin: 0 auto; display: block;">
                            <button type="button" id="remove-image" class="btn-text" style="margin-top: 8px; color: var(--destructive);">
                                <i class="fas fa-times"></i> Remove Image
                            </button>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Description</label>
                    <textarea name="description" placeholder="1) Your role and responsibilities&#10;2) Impact made and key learning" data-testid="input-activity-description"></textarea>
                </div>

                <div class="form-group">
                    <label>Category</label>
                    <select name="category" class="select-control select-control--category" data-testid="select-activity-category" required>
                        <option value="">Select category...</option>
                        <option value="creativity">Creativity</option>
                        <option value="activity">Activity</option>
                        <option value="service">Service</option>
                    </select>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="dateGeneral" data-testid="input-date-general" required>
                    </div>
                    <div class="form-group">
                        <label>Total Hours</label>
                        <input type="number" name="totalHours" min="0" step="0.5" placeholder="e.g., 3" data-testid="input-total-hours" required>
                    </div>
                </div>

                <div class="form-group">
                    <label>Status</label>
                    <select name="status" class="select-control select-control--status" data-testid="select-activity-status" required>
                        <option value="draft">Draft</option>
                        <option value="ongoing">Ongoing</option>
                        <option value="completed">Completed</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Challenge Faced</label>
                    <textarea name="challengeDescription" placeholder="Describe a challenge you faced during this activity." data-testid="input-challenge-description"></textarea>
                </div>

                <div class="form-group form-group--card">
                    <div class="card learning-outcomes-card" id="learning-outcomes-card">
                        <div class="learning-outcomes-card-header">
                            <div>
                                <h3>Learning Outcomes</h3>
                                <p class="helper-text">Select IB CAS outcomes (LO1–LO7) or add your own to highlight what you learned.</p>
                            </div>
                            <button type="button" class="btn btn-ghost btn-sm" id="clear-learning-outcomes" data-testid="button-clear-learning-outcomes">
                                Clear
                            </button>
                        </div>
                        <div class="learning-outcomes-card-body">
                            <div id="learning-outcomes-options" class="learning-outcomes-options" role="group" aria-label="Learning outcomes" data-testid="learning-outcomes-options"></div>
                            <div id="custom-outcome-wrapper" class="custom-outcome-wrapper" hidden>
                                <label for="custom-learning-outcome" class="custom-outcome-label">Custom learning outcomes</label>
                                <div class="custom-outcome-input">
                                    <input id="custom-learning-outcome" type="text" placeholder="Describe a unique learning outcome" autocomplete="off">
                                    <button type="button" class="btn btn-outline btn-sm" id="add-custom-learning-outcome" data-testid="button-add-custom-outcome">
                                        Add
                                    </button>
                                </div>
                                <p class="helper-text">Press Enter after each custom outcome to save it.</p>
                            </div>
                            <div id="learning-outcomes-list" class="learning-outcomes-list" role="list"></div>
                        </div>
                    </div>
                </div>

                <div class="form-grid form-grid--stacked">
                    <div class="form-group">
                        <label>Enjoyment Rating</label>
                        <div class="rating-input" id="rating-control" role="radiogroup" aria-label="Enjoyment rating" data-testid="rating-control">
                            <button type="button" class="rating-star" data-value="1" aria-label="1 star"><i class="fas fa-star"></i></button>
                            <button type="button" class="rating-star" data-value="2" aria-label="2 stars"><i class="fas fa-star"></i></button>
                            <button type="button" class="rating-star" data-value="3" aria-label="3 stars"><i class="fas fa-star"></i></button>
                            <button type="button" class="rating-star" data-value="4" aria-label="4 stars"><i class="fas fa-star"></i></button>
                            <button type="button" class="rating-star" data-value="5" aria-label="5 stars"><i class="fas fa-star"></i></button>
                        </div>
                        <input type="hidden" name="rating" id="rating-value" value="0">
                    </div>
                    <div class="form-group difficulty-group">
                        <label for="difficulty-input">Difficulty</label>
                        <input type="range" name="difficulty" id="difficulty-input" min="1" max="10" value="5" data-testid="input-difficulty">
                        <div class="difficulty-value"><span id="difficulty-value">5</span>/10</div>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" data-testid="button-save-activity">
                        <i class="fas fa-save"></i> Save Activity
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeAddActivityDialog()" data-testid="button-cancel-activity">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Reflection Dialog -->
    <div class="modal" id="add-reflection-modal">
        <div class="modal-content" data-testid="dialog-add-reflection">
            <div class="modal-header">
                <h3 data-testid="text-dialog-title">Add New Reflection</h3>
                <button class="modal-close" onclick="closeAddReflectionDialog()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p class="modal-description" data-testid="text-dialog-description">
                Write a reflection about one of your CAS activities.
            </p>
            
            <form id="add-reflection-form" class="modal-form">
                <div class="form-group">
                    <label>Activity</label>
                    <select name="activityId" class="select-control" data-testid="select-reflection-activity" required>
                        <option value="">Select an activity...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reflection Title</label>
                    <input type="text" name="title" placeholder="Enter reflection title..." data-testid="input-reflection-title" required>
                </div>
                <div class="form-group">
                    <label>Reflection Content</label>
                    <textarea name="content" placeholder="What did you learn? How did you grow?" data-testid="input-reflection-content" required></textarea>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary" data-testid="button-save-reflection">
                        <i class="fas fa-save"></i> Save Reflection
                    </button>
                    <button type="button" class="btn btn-outline" onclick="closeAddReflectionDialog()" data-testid="button-cancel-reflection">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Activity Detail Dialog -->
    <div class="modal" id="activity-detail-modal">
        <div class="modal-content" data-testid="dialog-activity-detail">
            <div class="modal-header">
                <h3 data-testid="text-dialog-title">Activity Details</h3>
                <button class="modal-close" onclick="closeActivityDetail()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="activity-detail-content"></div>
        </div>
    </div>

    <!-- Photos Gallery Dialog -->
    <div class="modal" id="photos-modal">
        <div class="modal-content" data-testid="dialog-photos-gallery">
            <div class="modal-header">
                <h3 data-testid="text-dialog-title">All Photos</h3>
                <button class="modal-close" onclick="closePhotosModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="photos-grid" class="gallery-grid"></div>
            <div id="photos-empty" class="empty-state" style="display: none;">
                <p data-testid="text-no-photos">No photos available yet. Add header images to your activities to see them here.</p>
            </div>
        </div>
    </div>

    <!-- Customize Floating Button -->
    <button class="btn btn-primary customize-fab" id="customize-fab" aria-label="Customize portfolio" onclick="openCustomizePanel()">
        <i class="fas fa-sliders-h" aria-hidden="true"></i>
    </button>

    <!-- Customization Panel -->
    <aside id="customize-panel" class="customize-panel" role="dialog" aria-modal="true" aria-labelledby="customize-title">
        <div class="customize-panel-header">
            <h3 class="customize-panel-title" id="customize-title">Customize Portfolio</h3>
            <button class="modal-close" aria-label="Close customization" onclick="closeCustomizePanel()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="customize-panel-body">
            <div class="customize-tabs" role="tablist">
                <button class="customize-tab active" role="tab" aria-selected="true" data-tab="layout">Layout</button>
                <button class="customize-tab" role="tab" aria-selected="false" data-tab="theme">Theme</button>
                <button class="customize-tab" role="tab" aria-selected="false" data-tab="content">Content</button>
            </div>
            <!-- Layout Tab -->
            <div id="tab-layout" class="panel-tab" aria-labelledby="tab-layout" >
                <div class="panel-section">
                    <h4>Sections</h4>
                    <div id="sections-list" class="sections-list" aria-describedby="sections-help"></div>
                    <p id="sections-help" class="helper-text">Drag to reorder. Toggle to show/hide. Use arrows for keyboard.</p>
                    <div class="panel-row">
                        <button class="btn btn-outline" onclick="openAddSectionModal()"><i class="fas fa-plus"></i> Add Section</button>
                        <button class="btn btn-outline" onclick="resetCustomization()"><i class="fas fa-undo"></i> Reset</button>
                    </div>
                </div>
            </div>
            <!-- Theme Tab -->
            <div id="tab-theme" class="panel-tab" hidden>
                <div class="panel-section">
                    <h4>Colors</h4>
                    <div class="panel-row">
                        <label for="color-primary">Primary</label>
                        <input type="color" id="color-primary" aria-label="Primary color">
                    </div>
                    <div class="panel-row">
                        <label for="color-secondary">Secondary</label>
                        <input type="color" id="color-secondary" aria-label="Secondary color">
                    </div>
                    <div class="panel-row">
                        <label for="color-accent">Accent</label>
                        <input type="color" id="color-accent" aria-label="Accent color">
                    </div>
                </div>
                <div class="panel-section">
                    <h4>Appearance</h4>
                    <div class="panel-row">
                        <label for="radius-range">Corner radius</label>
                        <input type="range" id="radius-range" min="0" max="16" step="1" aria-label="Corner radius">
                    </div>
                </div>
            </div>
            <!-- Content Tab -->
            <div id="tab-content" class="panel-tab" hidden>
                <div class="panel-section">
                    <h4>Hero</h4>
                    <div class="panel-row">
                        <label for="hero-image-url">Profile Image URL</label>
                        <input id="hero-image-url" class="small-input" type="url" placeholder="https://..." aria-label="Hero image URL">
                    </div>
                    <div class="panel-row panel-row-actions">
                        <button type="button" class="btn btn-outline btn-sm" id="hero-image-reset" data-testid="button-reset-hero-image">
                            <i class="fas fa-redo"></i>
                            Reset to default
                        </button>
                    </div>
                    <div class="panel-row">
                        <label for="toggle-inline-editing">Inline editing</label>
                        <input type="checkbox" id="toggle-inline-editing" role="switch" aria-checked="true">
                    </div>
                    <p class="helper-text">Tip: With inline editing on, click any highlighted text to edit directly.</p>
                </div>
                <div class="panel-section">
                    <h4>Brand</h4>
                    <div class="panel-row">
                        <label for="brand-image-url">Brand Image URL</label>
                        <input id="brand-image-url" class="small-input" type="url" placeholder="https://..." aria-label="Brand image URL">
                    </div>
                    <div class="panel-row">
                        <label for="brand-icon-class">Fallback Icon Class</label>
                        <input id="brand-icon-class" class="small-input" type="text" placeholder="fas fa-graduation-cap" aria-label="Brand icon class">
                    </div>
                    <p class="helper-text">Si no hay imagen, se usa el ícono configurado o el predeterminado.</p>
                </div>
                <div id="content-editor" class="panel-section panel-stack" aria-live="polite"></div>
            </div>
        </div>
        <div class="panel-footer">
            <span class="helper-text">Changes save automatically.</span>
            <div>
                <button class="btn btn-outline" onclick="closeCustomizePanel()">Close</button>
            </div>
        </div>
    </aside>

    <!-- Welcome Popup -->
    <div class="modal welcome-popup" id="welcome-popup" aria-hidden="true">
        <div class="modal-content welcome-popup-content" role="dialog" aria-modal="true" aria-labelledby="welcome-popup-title">
            <div class="welcome-popup-header">
                <h3 id="welcome-popup-title" data-testid="text-welcome-title">Welcome to Your CAS Portfolio! 🎉</h3>
            </div>
            <div class="welcome-popup-body">
                <p>Let's get started by answering a few quick questions to personalize your portfolio.</p>
                <p>This will help us create the best experience for tracking your CAS journey.</p>
            </div>
            <div class="welcome-popup-actions">
                <button class="btn btn-primary" id="start-setup-btn" data-testid="button-start-setup">
                    <i class="fas fa-rocket"></i> Get Started
                </button>
            </div>
        </div>
    </div>

    <!-- Add Custom Section Modal -->
    <div class="modal" id="add-section-modal">
        <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="add-section-title">
            <div class="modal-header">
                <h3 id="add-section-title">Add Custom Section</h3>
                <button class="modal-close" onclick="closeAddSectionModal()" aria-label="Close">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <form id="add-section-form" class="modal-form">
                <div class="form-group">
                    <label for="new-section-title">Section Title</label>
                    <input id="new-section-title" name="title" type="text" class="small-input" placeholder="e.g., Volunteering Impact" required>
                </div>
                <div class="form-group">
                    <label for="new-section-content">Section Content</label>
                    <textarea id="new-section-content" name="content" class="small-textarea" placeholder="Write your content..." required></textarea>
                </div>
                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary"><i class="fas fa-plus"></i> Add Section</button>
                    <button type="button" class="btn btn-outline" onclick="closeAddSectionModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        (function () {
            const logoutButtons = [
                document.getElementById('casfolio-logout'),
                document.getElementById('casfolio-logout-mobile')
            ].filter(Boolean);

            const loginLinks = [
                document.getElementById('casfolio-login-link'),
                document.getElementById('casfolio-mobile-login')
            ].filter(Boolean);

            if (logoutButtons.length === 0 && loginLinks.length === 0) {
                return;
            }

            const toggleHidden = (element, shouldHide) => {
                if (!element) return;
                element.hidden = shouldHide;
            };

            const hasSupabaseSession = () => {
                try {
                    const cookieEntries = (document.cookie || '').split(';');
                    const hasCookieSession = cookieEntries.some((entry) => {
                        const name = entry.trim().split('=')[0];
                        return Boolean(name) && name.startsWith('sb-');
                    });

                    if (hasCookieSession) {
                        return true;
                    }

                    if (typeof window !== 'undefined' && window.localStorage) {
                        if (window.localStorage.getItem('supabase.auth.token')) {
                            return true;
                        }

                        for (const key of Object.keys(window.localStorage)) {
                            if (key.startsWith('sb-')) {
                                return true;
                            }
                        }
                    }
                } catch (error) {
                    console.warn('Unable to inspect Supabase session state', error);
                }

                return false;
            };

            const updateAuthControls = () => {
                const authenticated = hasSupabaseSession();

                logoutButtons.forEach((button) => {
                    toggleHidden(button, !authenticated);
                    if (authenticated) {
                        button.removeAttribute('disabled');
                    } else {
                        button.setAttribute('disabled', 'true');
                    }
                });

                loginLinks.forEach((link) => {
                    toggleHidden(link, authenticated);
                });
            };

            const disableLogoutButtons = () => {
                logoutButtons.forEach((button) => {
                    button.setAttribute('disabled', 'true');
                });
            };

            const handleLogout = async () => {
                disableLogoutButtons();

                try {
                    const response = await fetch('/api/auth/signout', {
                        method: 'POST',
                        credentials: 'include',
                        cache: 'no-store'
                    });

                    if (!response.ok) {
                        console.error('Sign out request failed with status', response.status);
                    }
                } catch (error) {
                    console.error('Error calling sign out endpoint', error);
                }

                try {
                    await fetch('/api/auth/callback', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        credentials: 'include',
                        body: JSON.stringify({ event: 'SIGNED_OUT', session: null })
                    });
                } catch (error) {
                    console.error('Error notifying auth callback on sign out', error);
                }

                try {
                    if (typeof window !== 'undefined' && window.localStorage) {
                        Object.keys(window.localStorage).forEach((key) => {
                            if (key.startsWith('sb-') || key === 'supabase.auth.token') {
                                window.localStorage.removeItem(key);
                            }
                        });
                    }
                } catch (err) {
                    console.error('Error clearing Supabase tokens', err);
                }

                updateAuthControls();
                window.location.replace('/');
            };

            logoutButtons.forEach((button) => {
                button.hidden = true;
                button.addEventListener('click', handleLogout);
            });

            updateAuthControls();
            window.addEventListener('storage', updateAuthControls);
        })();
    </script>

    <!-- Scripts -->
    <script src="script.js"></script>
    <script src="customize.js"></script>
</body>
</html>
